{
    "collab_server" : "",
    "contents" : "\n#Definir workspace\nsetwd(\"C:\\\\Users\\\\Adrián\\\\Documents\\\\Numerico\\\\Pokedex\\\\Data\")\n\n#librerías\nlibrary(stringr)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tibble)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(ggmap)\nlibrary(leaflet)\nlibrary(maps)\nlibrary(MASS)\nlibrary(raster)\nlibrary(DT)\n\n\ndata_raw <-  read_csv(\"pokemon_sample.csv\")\n\npokestations <- read_csv(\"pokemon_pokestation.csv\")\n\ngyms <- read_csv(\"pokemon_gym.csv\")\n\n\n\ndata_raw$disappear_time <- as.POSIXct(data_raw$disappear_time,origin = \"1970-01-01\", tz=\"GMT\")\n\npokemon_db <- read_csv(\"pokemon_db.csv\")\n\ndf <- data_raw %>% \n        mutate(pokemon = str_to_lower(name)) %>% \n        left_join(pokemon_db, by = \"pokemon\")\n\npoke_summary_type_empiric <- df %>% \n                  group_by(type_1) %>% \n                  summarize(count_empiric=n()) %>% \n                  arrange(desc(count_empiric)) %>% \n                  na.omit %>% \n                  mutate(count_empiric=100*count_empiric/sum(count_empiric))\n\npoke_summary_type_original <- pokemon_db[1:150,] %>% \n                                group_by(type_1) %>% \n                                summarize(count_original=n()) %>% \n                                arrange(desc(count_original)) %>% \n                                mutate(count_original=100*count_original/sum(count_original))\n\npoke_summary_all <- left_join(poke_summary_type_empiric, \n                              poke_summary_type_original, by=\"type_1\") %>% \n                    gather(sample, frequency, 2:3)\n\n#Gr?fica1\nggplot(poke_summary_all) +\n  aes(x = type_1, y = frequency, fill = sample) +\n  geom_bar(stat = \"identity\", position= position_dodge()) +\n  coord_flip()\n\n      \nleaflet(df %>% filter(type_1==\"water\")) %>% \n  addTiles() %>% \n  addCircleMarkers(~lng,\n                   ~lat,  \n                   popup = ~paste(type_1, name), \n                   color = ~color_1 ,\n                   radius=2)\n\nleaflet(df %>% filter(as.Date(disappear_time)>=\"2016-07-21\", type_1 == \"electric\")) %>%\n  addTiles() %>%\n  addCircleMarkers(~lng,\n                   ~lat,\n                   popup = ~paste(type_1, name),\n                   color = ~color_1 ,\n                   radius=2)\n\n\nleaflet(df %>% filter(as.Date(disappear_time)<=as.Date(\"2016-07-18\"))) %>%\n  addTiles() %>%\n  addCircleMarkers(~lng,\n                   ~lat,\n                   popup = ~paste(type_1, name),\n                   color = ~color_1 ,\n                   radius=2)\n\nleaflet(df %>% filter(as.Date(disappear_time)>as.Date(\"2016-07-18\"),\n                      as.Date(disappear_time)<=as.Date(\"2016-07-20\"))) %>%\n  addTiles() %>%\n  addCircleMarkers(~lng,\n                   ~lat,\n                   popup = ~paste(type_1, name),\n                   color = ~color_1 ,\n                   radius=2)\n\nleaflet(df %>% filter(as.Date(disappear_time)>as.Date(\"2016-07-20\"),\n                      as.Date(disappear_time)<=as.Date(\"2016-07-21\"))) %>%\n  addTiles() %>%\n  addCircleMarkers(~lng,\n                   ~lat,\n                   popup = ~paste(type_1, name),\n                   color = ~color_1 ,\n                   radius=2)\n\nleaflet(df %>% filter(as.Date(disappear_time)>as.Date(\"2016-07-21\"),\n                      as.Date(disappear_time)<=as.Date(\"2016-07-22\"))) %>%\n  addTiles() %>%\n  addCircleMarkers(~lng,\n                   ~lat,\n                   popup = ~paste(type_1, name),\n                   color = ~color_1 ,\n                   radius=2)\n\nleaflet(df %>% filter(as.Date(disappear_time)>=as.Date(\"2016-07-23\"))) %>%\n  addTiles() %>%\n  addCircleMarkers(~lng,\n                   ~lat,\n                   popup = ~paste(type_1, name),\n                   color = ~color_1 ,\n                   radius=2)\n\nleaflet(pokestations) %>%\n  addTiles() %>%\n  #addMarkers(~lng,~lat,icon=icons(iconUrl = \"http://cdm.numerico.mx/charts/pokedex/icons/Pstop.png\"))\n  addCircleMarkers(~lng,~lat,color= '#053E7D', fillColor= '#3177C5', fillOpacity= 0.5, radius=2)\n\n\nmap_data <- df %>% filter(type_1==\"fire\")\n\nleafIcons <- icons(iconUrl = map_data$url_icon)\n\nleaflet(map_data) %>% \n  addTiles() %>% \n  addMarkers(~lng,~lat, popup = ~paste(type_1, name), icon=icons(iconUrl = map_data$url_icon))\n\nleaflet(gyms) %>%\n  addTiles() %>%\n  addMarkers(~lng,~lat,icon=icons(iconUrl = \"http://cdm.numerico.mx/charts/pokedex/icons/Uncontested.png\"))\n\n\n\n############################ NIDOS ###################################\nmap_data <- df %>% filter(pokemon ==\"dratini\")\n\nleafIcons <- icons(iconUrl = map_data$url_icon)#, iconWidth = 70, iconHeight = 105)\n\ndensity_loc <- kde2d(map_data$lng, map_data$lat, c(0.05,0.05), n=100)\n\nloc_density_raster <- raster::raster(\n  list(x = density_loc$x, y = density_loc$y, z = density_loc$z)\n)\n\ncolor_pal <- leaflet::colorNumeric(\n  palette = c(\"#FFFFCC\", \"#41B6C4\", \"#0C2C84\"),\n  domain = raster::values(loc_density_raster), \n  na.color = \"transparent\"\n)\n\nleaflet(map_data) %>% \n  addTiles() %>% \n  #addCircleMarkers(~lng,~lat,radius=0.001, popup = ~paste(pokemon, disappear_time)) %>% \n  addMarkers(~lng,~lat, icon = leafIcons,  popup = ~paste(type_1, name)) %>%\n  addRasterImage(x = loc_density_raster, opacity = 0.5 ,project = FALSE) %>% \n  addLegend(pal = color_pal, values = values(loc_density_raster))\n\n\n################################### static ##################################\n\nmyMap <- get_map(location=\"Mexico City\", crop=FALSE, zoom=11, maptype = \"roadmap\", source=\"osm\")\n\nmap_data <- df %>% filter(pokemon==\"sandshrew\")\n\nggmap(myMap)+\n  stat_density2d(\n    aes(x = lng, y = lat, fill = ..level.., alpha=..level..), \n    data=map_data, geom=\"polygon\", h=c(0.05,0.05))+\n  geom_point(aes(x = lng, y = lat), data=map_data)+\n  scale_fill_gradient(low=\"red\", high=\"white\", space=\"Lab\")+\n  theme_nothing()\n\n\n\n############################## MAPAS MÁS RECIENTES ################################\n\ngyms <- read_csv(\"gym.csv\")\n\ngyms <- gyms %>% filter(lat<20, lng > -99.5)\n\nleaflet(gyms) %>%\n  addTiles() %>%\n  addMarkers(~lng,~lat, popup = ~paste('<a class=\"popUp\" href=\"https://www.google.com/maps/dir/Current+Location/',lat,',',lng,'\" target=\"_blank\">Dime cómo llegar</a>'),icon=icons(iconUrl = \"http://cdm.numerico.mx/charts/pokedex/icons/Uncontested.png\"))\n\npokeStops <- read_csv(\"pok.csv\")\n\npokeStops <- pokeStops %>% filter(lat<20, as.numeric(lat)>19.1 , lng > -99.5)\n\nleaflet(pokeStops) %>%\n  addTiles() %>%\n  addCircleMarkers(~lng,~lat, \n                   popup = ~paste('<a class=\"popUp\" href=\"https://www.google.com/maps/dir/Current+Location/',lat,',',lng,'\" target=\"_blank\">Dime cómo llegar</a>'),\n                   color= '#03A9F4', \n                   fillColor= '#00BCD4', \n                   fillOpacity= 0.5, \n                   radius=2)\n\npokemon_sights <- read_csv(\"pokemon_sights.csv\")\n\npokemon_sights$disappear_time <- as.POSIXct(pokemon_sights$disappear_time,origin = \"1970-01-01\", tz=\"GMT\")\n\ndf <- pokemon_sights %>% \n  mutate(pokemon = str_to_lower(name)) %>% \n  left_join(pokemon_db, by = \"pokemon\")\n\ndf <- filter(df, lat<20, lng > -99.5)\n\nleaflet(df) %>%\n  addTiles() %>%\n  addMarkers(~lng,~lat, popup = ~paste(type_1,name),icon=icons(iconUrl = df$url_icon))\n\n\n\n########################## HISTOGRAMA RAREZA ##########################################\n\npokemon_db <- read_csv(\"pokemon_db.csv\")\n\npokemon_sights <- read_csv(\"pokemon_sights.csv\")\n\npokemon_sights$disappear_time <- as.POSIXct(pokemon_sights$disappear_time,origin = \"1970-01-01\", tz=\"GMT\")\n\ndf <- pokemon_sights %>% \n  mutate(pokemon = str_to_lower(name)) %>% \n  left_join(pokemon_db, by = \"pokemon\")\n\npokemon_frequency <- df %>%\n                      group_by(pokemon) %>% \n                      summarize(count_sights=n()) %>%\n                      arrange(desc(count_sights)) %>% \n                      na.omit %>%\n                      left_join(pokemon_db %>% subset(select=c(pokemon, url_icon)) , by=\"pokemon\") %>%\n                      mutate(pokemon=paste('<img src=\"',url_icon,'\" ></img>          ',paste0(toupper(substr(pokemon, 1, 1)), substr(pokemon, 2, nchar(pokemon))))) %>%\n                      mutate(count_sights=(5613/count_sights))\n\ndatatable(pokemon_frequency[,c(1,2)],\n          rownames=FALSE,\n          colnames = c('Pokemon','Número de Zubat por cada pokemon'),\n          options = list(\n            columnDefs = list(list(className = 'dt-center', targets = 0)),\n            columnDefs = list(list(className = 'dt-right', targets = 1))\n          ),\n          escape=FALSE) %>% \n      formatRound(~count_sights, 0)\n\n#Histograma frecuencias\nggplot(pokemon_frequency) +\n  aes(x = pokemon, y = count_sights) +\n  geom_bar(stat = \"identity\") +\n  coord_flip()  \n\n\n############################ Coordenadas para los nidos ##############################\n\npokemon_db <- read_csv(\"pokemon_db.csv\")\n\npokemon_sights <- read_csv(\"pokemon_sights.csv\")\n\npokemon_sights$disappear_time <- as.POSIXct(pokemon_sights$disappear_time,origin = \"1970-01-01\", tz=\"GMT\")\n\ndf <- pokemon_sights %>% \n  mutate(pokemon = str_to_lower(name)) %>% \n  left_join(pokemon_db, by = \"pokemon\")\n\nmap_data <- df %>% filter(pokemon==\"krabby\")\n\nleaflet(map_data) %>%\n  addTiles() %>%\n  addMarkers(~lng,~lat, popup = ~paste(\"Lat: \",lat,\"  Long: \",lng),icon=icons(iconUrl = map_data$url_icon))\n\n######################### MAPA CON LOS NIDOS POKEMON #################################\n\npokenests <- read_csv(\"pokeNest.csv\")\n\npokenests <- pokenests %>%\n  left_join(pokemon_db, by='pokemon')\n\nleaflet(pokenests) %>%\n  addTiles() %>%\n  addMarkers(~lng,~lat,icon=icons(iconUrl=pokenests$url_icon),\n             popup= ~paste('<p class=\"popUp\">Nido de ',paste0(toupper(substr(pokemon, 1, 1)), substr(pokemon, 2, nchar(pokemon))),'<br>Tipo: ',paste0(toupper(substr(type_1, 1, 1)), substr(type_1, 2, nchar(type_1))),'<br><a href=\"https://www.google.com/maps/dir/Current+Location/',lat,',',lng,'\" target=\"_blank\">Dime cómo llegar</a></p>'))\n",
    "created" : 1469988299753.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "75788865",
    "id" : "156B031A",
    "lastKnownWriteTime" : 1470034459,
    "last_content_update" : -2147483648,
    "path" : "~/Numerico/Pokedex/analysis.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}